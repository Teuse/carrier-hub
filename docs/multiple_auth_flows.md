# Is it possible to have multiple different auth tenants in parallel?

Example: EntraID and Keycloak

## Thoughts

I think yes, but you will need to decided somewhere on which to use, because this changes the token handling. So this could be done based on user decision at the login mask (frontend). Both are based on JWT, as far as I know. The backend could then decide based on the API-endpoint that was targeted (e.g. `/api/auth/entra_id` vs. `/api/auth/keycloak`). Alternatively - and this is [the way Spring Boot suggests it](https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/multitenancy.html) - one could use the JWT directly by decoding it and looking at the `iss`claim, which then tells the backend, which issuer to target. In Spring you would need some logic that differentiates the tokens from one another. For example, the username-field in the tokens have different namings in EntraID vs Keycloak. This either needs to be run through the whole backend application, or there needs to be some sort of custom unification class that translates to common namings. These differences could also be used as a decision base vs. the endpoint-based approach mentoined before.
In a more elaborate application, which might use an API Gateway that handles the auth already, I have no idea how it would work then.

As an alternative to the complex changes above there is also the approach described [here](https://www.keycloak.org/docs/latest/server_admin/index.html#_identity_broker): One can use Keycloak as an intermediary auth client that internally uses e.g. Microsoft as an identity provider and gets the user information from there. In terms of user roles, one has two options: 1. Create a mapper in Keycloak to map the Azure roles to the roles of the Keycloak realm(), 2. Handle the roles purely in Keycloak, which is the more flexible option especially when multiple identity providers should be allowed. This way, the identity providers are purely responsible for authentication, and Keycloak handles the authorization
In terms of implementation, we would now need to switch the frontend from MSAL to some keycloak-library (I am sure there is some) and in the backend change the OAuth2-resourceserver (`spring.security.oauth2.resourceserver.jwt.issuer-uri`).